#!/usr/bin/env bash
set -euo pipefail

warn() {
  echo "warning: $(tput setaf 3)$*$(tput sgr0)" >&2
}

fatal() {
  echo "fatal error: $(tput setaf 1)$*$(tput sgr0)" >&2
  exit 1
}

main() {
  local flag
  local postrun
  while (( "$#" )); do
    flag=""
    postrun=""
    case "$1" in
      -o|-open)  # do something
        flag="$1"
        postrun="open_file"
        shift
        ;;
    esac
    if [[ "${1-}" ]]; then
      if [[ "$postrun" ]]; then
        fatal "Got flag $flag but no argument after"
      else
        warn "Got blank argument - skipping"
      fi
    fi
    create_file "$1"
    if [[ "$postrun" ]]; then
      "$postrun"
    fi
  done
}

main "$@"
